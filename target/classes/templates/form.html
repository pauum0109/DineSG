<!--Kiểm soát bang Id-->
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Document</title>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Poppins:wght@400;500&display=swap');

        *{
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Poppins',sans-serif;
        }
        body{
            display: flex;
            justify-content: center;
            align-items: center;
            min-height: 100vh;
            background: #dfdfdf;
        }
        .login-box{
            display: flex;
            justify-content: center;
            flex-direction: column;
            width: 440px;
            height: 480px;
            padding: 30px;
        }
        .login-header{
            text-align: center;
            margin: 20px 0 40px 0;
        }
        .login-header header{
            color: #333;
            font-size: 30px;
            font-weight: 600;
        }
        .input-box .input-field{
            width: 100%;
            height: 60px;
            font-size: 17px;
            padding: 0 25px;
            margin-bottom: 15px;
            border-radius: 30px;
            border: none;
            box-shadow: 0px 5px 10px 1px rgba(0,0,0, 0.05);
            outline: none;
            transition: .3s;
        }
        ::placeholder{
            font-weight: 500;
            color: #222;
        }
        .input-field:focus{
            width: 105%;
        }
        .forgot{
            display: flex;
            justify-content: space-between;
            margin-bottom: 40px;
        }
        section{
            display: flex;
            align-items: center;
            font-size: 14px;
            color: #555;
        }
        #check{
            margin-right: 10px;
        }
        a{
            text-decoration: none;
        }
        a:hover{
            text-decoration: underline;
        }
        section a{
            color: #555;
        }
        .input-submit{
            position: relative;
        }
        .submit-btn{
            width: 100%;
            height: 60px;
            background: #222;
            border: none;
            border-radius: 30px;
            cursor: pointer;
            transition: .3s;
        }
        .input-submit label{
            position: absolute;
            top: 45%;
            left: 50%;
            color: #fff;
            -webkit-transform: translate(-50%, -50%);
            -ms-transform: translate(-50%, -50%);
            transform: translate(-50%, -50%);
            cursor: pointer;
        }
        .submit-btn:hover{
            background: #000;
            transform: scale(1.05,1);
        }
        .sign-up-link{
            text-align: center;
            font-size: 15px;
            margin-top: 20px;
        }
        .sign-up-link a{
            color: #000;
            font-weight: 600;
        }
    </style>
</head>

<body th:data-error-state="${state ?: 'NO_ERROR'}">
<form id="form" th:action="@{/account/login}" method="post" class="form-container">
    <div class="error-box hidden" id="errorBox">
        <p class="error-text" id="message_error"></p>
        <button class="close-btn" onclick="closeErrorBox()">&times;</button>
    </div>
    <p id="test" th:value="${username}"></p>

    <div id="username-container">
        <label for="username">Username:</label>
        <input
                th:value="${username ?: ''}"
                type="text"
                id="username"
                name="username"
                placeholder="Username"

        >
    </div>
    <div id="password-container">
        <label for="password">Password:</label>
        <input
                type="text"
                id="password"
                name="password"
                placeholder="Password"

        >
    </div>
    <div>
        <button type="submit">Login</button>
    </div>
</form>
<script th:inline="javascript">




    // -------------View base response from server------------------//
    const errorMessage = document.getElementById('message_error');
    const errorState = document.body.getAttribute('data-error-state');

    function handleErrorState(state) {  //Hàm này input vào state view cho từng trạng thái lỗi từ server
        const errorBox = document.querySelector('.error-box');

        if (state === 'ERROR') {
            //Thêm class css,data,....
            errorMessage.textContent = "Wrong username or password";
            document.querySelector('input[name="username"]').classList.add('input-error');
            document.querySelector('input[name="password"]').classList.add('input-error');
            errorBox.classList.remove('hidden');
        }
        document.addEventListener("DOMContentLoaded", function () {
            if (state === 'SUCCESS') {
                alert("login success"); // Show the success alert
                // After the alert, redirect to the index page
                window.location.href = "/index";
            }
        });
    }

    // Call the function with the current state
    handleErrorState(errorState);
    //-----------------------------Validate user input, check trống------------------//
    document.getElementById('form').addEventListener('submit', function (e) {
        e.preventDefault();
        // Get form inputs
        const errorMessage = document.getElementById('message_error');
        let isValid = true;
        const username = document.getElementById('username');
        const password = document.getElementById('password');
        const errorBox = document.querySelector('.error-box');
        username.classList.remove('input-error');
        password.classList.remove('input-error');
        errorMessage.textContent = '';
        errorBox.classList.add('hidden'); // Hide the error box initially
        if (username.value.trim() === '') {
            username.classList.add('input-error');
            errorMessage.textContent = 'Missing username';
            errorBox.classList.remove('hidden');
            isValid = false;
        } else if (password.value.trim() === '') {
            // document.getElementById('emailError').textContent = 'Password is required.';
            password.classList.add('input-error');
            errorMessage.textContent = 'Missing password';
            errorBox.classList.remove('hidden');
            isValid = false;
        }
        // If validation passes, submit the form
        if (isValid) {
            errorBox.classList.add('hidden');
            this.submit();
        }
    });
    function closeErrorBox() {
        const username = document.getElementById('username');
        const password = document.getElementById('password');
        username.classList.remove('input-error');
        password.classList.remove('input-error');
        document.getElementById("errorBox").style.display = "none";
    }
</script>
</body>
</html>